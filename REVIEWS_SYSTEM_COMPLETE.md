# ๐ ุณุณุชู ูุธุฑุงุช ู ุงูุชุงุฒุฏู - ูพุงุฏูโุณุงุฒ ฺฉุงูู

## ๐ ุฎูุงุตู ูพุงุฏูโุณุงุฒ

ุณุณุชู ูุธุฑุงุช ู ุงูุชุงุฒุฏู ุจุง ููููุช ุจู ูพูุชูุฑู ฺฏุงุฑุงฺ ุณูฺฏู ุงุถุงูู ุดุฏ. ุงู ุณุณุชู ุดุงูู ุงูฺฉุงูุงุช ฺฉุงูู ุจุฑุง ูุฏุฑุช ูุธุฑุงุช ฺฉุงุฑุจุฑุงูุ ุงูุชุงุฒุฏูุ ู ูพุงุณุฎโฺฏู ูุฏุฑุช ุงุณุช.

## ๐๏ธ ุชุบุฑุงุช ุฏุชุงุจุณ

### ุฌุฏูู ุฌุฏุฏ: `reviews`
```sql
CREATE TABLE reviews (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    listing_id INTEGER NOT NULL,
    user_id INTEGER NOT NULL,
    rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
    comment TEXT,
    is_approved INTEGER DEFAULT 0,
    is_verified_purchase INTEGER DEFAULT 0,
    admin_response TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (listing_id) REFERENCES listings(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE(listing_id, user_id)
);
```

### ุณุชููโูุง ุฌุฏุฏ ุฏุฑ ุฌุฏูู `listings`
- `average_rating REAL DEFAULT 0`: ูุงูฺฏู ุงูุชุงุฒ ุขฺฏู
- `total_reviews INTEGER DEFAULT 0`: ุชุนุฏุงุฏ ฺฉู ูุธุฑุงุช

### ุงูุฏฺฉุณโูุง ู Trigger
- ุงูุฏฺฉุณโูุง ุจูููโุณุงุฒ ุจุฑุง ุฌุณุชุฌู
- Trigger ุฎูุฏฺฉุงุฑ ุจุฑุง ุจูโุฑูุฒุฑุณุงู ูุงูฺฏู ุงูุชุงุฒ

## ๐ง API Endpoints

### ๐ ุฏุฑุงูุช ูุธุฑุงุช
```
GET /api/reviews/listing/:listingId
Query Parameters:
- page: ุดูุงุฑู ุตูุญู (ูพุดโูุฑุถ: 1)
- limit: ุชุนุฏุงุฏ ูุธุฑุงุช ุฏุฑ ุตูุญู (ูพุดโูุฑุถ: 10)
- sort: ุชุฑุชุจ ููุงุด (newest, oldest, highest, lowest)

Response:
{
  "success": true,
  "data": {
    "reviews": [...],
    "pagination": {...},
    "statistics": {
      "total_reviews": 15,
      "average_rating": 4.2,
      "rating_distribution": [...]
    }
  }
}
```

### โ๏ธ ุซุจุช ูุธุฑ ุฌุฏุฏ
```
POST /api/reviews
Headers: Authorization: Bearer <token>
Body:
{
  "listing_id": 1,
  "rating": 5,
  "comment": "ูุธุฑ ฺฉุงุฑุจุฑ..."
}
```

### โ๏ธ ูุฑุงุด ูุธุฑ
```
PUT /api/reviews/:reviewId
Headers: Authorization: Bearer <token>
Body:
{
  "rating": 4,
  "comment": "ูุธุฑ ูุฑุงุด ุดุฏู..."
}
```

### ๐๏ธ ุญุฐู ูุธุฑ
```
DELETE /api/reviews/:reviewId
Headers: Authorization: Bearer <token>
```

### ๐ค ูุธุฑุงุช ฺฉุงุฑุจุฑ
```
GET /api/reviews/user/my-reviews
Headers: Authorization: Bearer <token>
```

## ๐ก๏ธ API ูุง ูุฏุฑุช (ุงุฏูู)

### ๐ ุฏุฑุงูุช ููู ูุธุฑุงุช
```
GET /api/admin/reviews
Query Parameters:
- page, limit: ุตูุญูโุจูุฏ
- status: all, pending, approved, rejected
- search: ุฌุณุชุฌู ุฏุฑ ูุธุฑุงุช

Headers: Authorization: Bearer <admin_token>
```

### ๐ ุขูุงุฑ ูุธุฑุงุช
```
GET /api/admin/reviews/stats
Headers: Authorization: Bearer <admin_token>

Response:
{
  "success": true,
  "data": {
    "total": 50,
    "pending": 5,
    "approved": 40,
    "rejected": 5,
    "average_rating": 4.2
  }
}
```

### โ ุชุงุฏ/ุฑุฏ ูุธุฑ
```
PUT /api/admin/reviews/:reviewId/approve
Headers: Authorization: Bearer <admin_token>
Body:
{
  "approve": true
}
```

### ๐ฌ ูพุงุณุฎ ูุฏุฑุช
```
PUT /api/admin/reviews/:reviewId/response
Headers: Authorization: Bearer <admin_token>
Body:
{
  "response": "ูพุงุณุฎ ูุฏุฑุช..."
}
```

## ๐จ ฺฉุงููพูููุชโูุง ูุฑุงูุชโุงูุฏ

### 1. ReviewsSection.tsx
ฺฉุงููพูููุช ุงุตู ููุงุด ู ูุฏุฑุช ูุธุฑุงุช ุฏุฑ ุตูุญู ุฌุฒุฆุงุช ุขฺฏู:

**ูฺฺฏโูุง:**
- ููุงุด ุขูุงุฑ ฺฉู ุงูุชุงุฒุงุช
- ููุงุด ุชูุฒุน ุงูุชุงุฒุงุช (ูููุฏุงุฑ ูููโุง)
- ูุณุช ูุธุฑุงุช ุจุง ุตูุญูโุจูุฏ
- ูุฑู ุซุจุช ูุธุฑ ุฌุฏุฏ
- ูุฑุชุจโุณุงุฒ ูุธุฑุงุช
- ููุงุด ูพุงุณุฎ ูุฏุฑุช

### 2. AdminReviews.tsx
ูพูู ูุฏุฑุช ูุธุฑุงุช ุจุฑุง ุงุฏูู:

**ูฺฺฏโูุง:**
- ุฏุงุดุจูุฑุฏ ุขูุงุฑ
- ููุชุฑ ู ุฌุณุชุฌู ุฏุฑ ูุธุฑุงุช
- ุชุงุฏ/ุฑุฏ ูุธุฑุงุช
- ุงุถุงูู ฺฉุฑุฏู ูพุงุณุฎ ูุฏุฑุช
- ูุดุงูุฏู ุฌุฒุฆุงุช ุขฺฏู

## ๐ ุงููุช ู ุงุนุชุจุงุฑุณูุฌ

### ูุญุฏูุฏุชโูุง ุงููุช:
- ฺฉุงุฑุจุฑ ููโุชูุงูุฏ ุจู ุขฺฏู ุฎูุฏุด ูุธุฑ ุฏูุฏ
- ูุฑ ฺฉุงุฑุจุฑ ููุท ฺฉ ูุธุฑ ุจุฑุง ูุฑ ุขฺฏู
- ุงุนุชุจุงุฑุณูุฌ ฺฉุงูู ูุฑูุฏโูุง
- ูุญุงูุธุช ุฏุฑ ุจุฑุงุจุฑ XSS ู SQL Injection
- Rate limiting ุจุฑุง ุฌููฺฏุฑ ุงุฒ spam

### ุงุนุชุจุงุฑุณูุฌ:
- ุงูุชุงุฒ: 1 ุชุง 5
- ูุธุฑ: ุญุฏุงฺฉุซุฑ 1000 ฺฉุงุฑุงฺฉุชุฑ
- ูพุงุณุฎ ุงุฏูู: ุญุฏุงฺฉุซุฑ 500 ฺฉุงุฑุงฺฉุชุฑ

## ๐ฑ ุชุฌุฑุจู ฺฉุงุฑุจุฑ

### ุจุฑุง ฺฉุงุฑุจุฑุงู:
- ุฑุงุจุท ฺฉุงุฑุจุฑ ุณุงุฏู ู ุฒุจุง
- ุงูุชุงุฒุฏู ุจุง ุณุชุงุฑูโูุง ุชุนุงูู
- ููุงุด ุขูุงุฑ ฺฉุงูู ุงูุชุงุฒุงุช
- ุงูฺฉุงู ูุฑุงุด ู ุญุฐู ูุธุฑ ุดุฎุต
- ููุงุด ูุธุฑุงุช ุจุง ุตูุญูโุจูุฏ

### ุจุฑุง ูุฏุฑุงู:
- ุฏุงุดุจูุฑุฏ ุฌุงูุน ูุฏุฑุช ูุธุฑุงุช
- ููุชุฑูุง ูพุดุฑูุชู
- ุงูฺฉุงู ูพุงุณุฎโฺฏู ุจู ูุธุฑุงุช
- ุขูุงุฑ ู ฺฏุฒุงุฑุดโฺฏุฑ

## ๐ ูุญูู ุงุณุชูุงุฏู

### 1. ุจุฑุง ฺฉุงุฑุจุฑุงู:
1. ูุงุฑุฏ ุตูุญู ุฌุฒุฆุงุช ุขฺฏู ุดูุฏ
2. ุฏุฑ ุจุฎุด ูุธุฑุงุชุ ุฑู "ุซุจุช ูุธุฑ" ฺฉูฺฉ ฺฉูุฏ
3. ุงูุชุงุฒ ู ูุธุฑ ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ
4. ูุธุฑ ุดูุง ูพุณ ุงุฒ ุชุงุฏ ูุฏุฑ ููุงุด ุฏุงุฏู ูโุดูุฏ

### 2. ุจุฑุง ูุฏุฑุงู:
1. ูุงุฑุฏ ูพูู ุงุฏูู ุดูุฏ
2. ุจุฎุด "ูุธุฑุงุช" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
3. ูุธุฑุงุช ุฑุง ุจุฑุฑุณ ู ุชุงุฏ/ุฑุฏ ฺฉูุฏ
4. ุฏุฑ ุตูุฑุช ูุงุฒ ูพุงุณุฎ ููุงุณุจ ุงุฑุงุฆู ุฏูุฏ

## ๐งช ุชุณุชโูุง

### ุชุณุชโูุง ุงูุฌุงู ุดุฏู:
- โ API ุฏุฑุงูุช ูุธุฑุงุช
- โ ูุญุงูุธุช API ูุง ูุญุฏูุฏ
- โ ูุฏุฑุช ุฎุทุงูุง
- โ ุงุนุชุจุงุฑุณูุฌ ูุฑูุฏโูุง

### ูุงูโูุง ุชุณุช:
- `server/test-reviews-simple.js`: ุชุณุชโูุง ุงููู API
- `server/test-reviews-api.js`: ุชุณุชโูุง ฺฉุงูู (ูุงุฒ ุจู OTP)

## ๐ ุขูุงุฑ ู ฺฏุฒุงุฑุดโฺฏุฑ

ุณุณุชู ุขูุงุฑ ฺฉุงูู ุงุฑุงุฆู ูโุฏูุฏ:
- ุชุนุฏุงุฏ ฺฉู ูุธุฑุงุช
- ูุธุฑุงุช ุฏุฑ ุงูุชุธุงุฑ ุชุงุฏ
- ูุธุฑุงุช ุชุงุฏ ุดุฏู/ุฑุฏ ุดุฏู
- ูุงูฺฏู ุงูุชุงุฒ ฺฉู
- ุชูุฒุน ุงูุชุงุฒุงุช (1 ุชุง 5 ุณุชุงุฑู)

## ๐ ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ

ุณุณุชู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ:
- ูุงูฺฏู ุงูุชุงุฒ ุขฺฏูโูุง ุฑุง ูุญุงุณุจู ูโฺฉูุฏ
- ุชุนุฏุงุฏ ูุธุฑุงุช ุฑุง ุจูโุฑูุฒุฑุณุงู ูโฺฉูุฏ
- ุขูุงุฑ ฺฉู ุฑุง ูฺฏูุฏุงุฑ ูโฺฉูุฏ

## ๐ฏ ูุฒุงุง ูพุงุฏูโุณุงุฒ

1. **ฺฉุงุฑุจุฑูพุณูุฏ**: ุฑุงุจุท ุณุงุฏู ู ุฒุจุง
2. **ุงูู**: ูุญุงูุธุช ฺฉุงูู ุฏุฑ ุจุฑุงุจุฑ ุชูุฏุฏุงุช
3. **ููุงุณโูพุฐุฑ**: ูุงุจูุช ูุฏุฑุช ุญุฌู ุจุงูุง ูุธุฑุงุช
4. **ูุงุจู ูุฏุฑุช**: ูพูู ฺฉุงูู ุจุฑุง ูุฏุฑุงู
5. **ุจููู**: ุงุณุชูุงุฏู ุงุฒ ุงูุฏฺฉุณโูุง ู trigger ูุง

## ๐ฎ ุงูฺฉุงูุงุช ุขูุฏู

- ุงุนูุงูโูุง real-time ุจุฑุง ูุธุฑุงุช ุฌุฏุฏ
- ุณุณุชู ฺฏุฒุงุฑุด ูุธุฑุงุช ูุงููุงุณุจ
- ุงูุชุงุฒุฏู ุจู ุฎูุฏ ูุธุฑุงุช (ููุฏ/ุบุฑููุฏ)
- ุชฺฏโฺฏุฐุงุฑ ุฎูุฏฺฉุงุฑ ูุธุฑุงุช
- ุชุญูู ุงุญุณุงุณุงุช ูุธุฑุงุช

---

## โ ูุถุนุช: ูพุงุฏูโุณุงุฒ ฺฉุงูู ุดุฏ

ุณุณุชู ูุธุฑุงุช ู ุงูุชุงุฒุฏู ุจู ุทูุฑ ฺฉุงูู ูพุงุฏูโุณุงุฒ ุดุฏู ู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช. ุชูุงู API ูุงุ ฺฉุงููพูููุชโูุง ูุฑุงูุชโุงูุฏุ ู ูพูู ูุฏุฑุช ฺฉุงุฑ ูโฺฉููุฏ.

**ุชุงุฑุฎ ุชฺฉูู:** 15 ููุงูุจุฑ 2025  
**ูุณุฎู:** 1.0.0  
**ูุถุนุช:** โ ุขูุงุฏู ุชููุฏ