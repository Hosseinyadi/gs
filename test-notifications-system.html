<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ Ùˆ ØªÙ…Ø¯ÛŒØ¯</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }
        .header h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .status {
            display: inline-block;
            padding: 8px 20px;
            background: #10b981;
            color: white;
            border-radius: 20px;
            font-weight: bold;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-primary { background: #667eea; color: white; }
        .btn-success { background: #10b981; color: white; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.success { background: #d1fae5; color: #065f46; }
        .result.error { background: #fee2e2; color: #991b1b; }
        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .endpoint {
            background: #f3f4f6;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 5px 0;
        }
        .icon { font-size: 1.5em; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”” ØªØ³Øª Ø³ÛŒØ³ØªÙ… Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ØŒ Ø¢Ù…Ø§Ø± Ùˆ ØªÙ…Ø¯ÛŒØ¯</h1>
            <div class="status">âœ… Ø³ÛŒØ³ØªÙ… Ø¢Ù…Ø§Ø¯Ù‡</div>
        </div>

        <div class="grid">
            <!-- Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ -->
            <div class="card">
                <h2><span class="icon">ğŸ””</span> Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</h2>
                <button class="test-btn btn-primary" onclick="testNotifications()">
                    Ø¯Ø±ÛŒØ§ÙØª Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
                </button>
                <button class="test-btn btn-success" onclick="testUnreadCount()">
                    ØªØ¹Ø¯Ø§Ø¯ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
                </button>
                <button class="test-btn btn-warning" onclick="testMarkAllRead()">
                    Ø®ÙˆØ§Ù†Ø¯Ù† Ù‡Ù…Ù‡
                </button>
                <div class="endpoint">GET /api/notifications</div>
                <div id="notifications-result"></div>
            </div>

            <!-- Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²Ø¯ÛŒØ¯ -->
            <div class="card">
                <h2><span class="icon">ğŸ“Š</span> Ø¢Ù…Ø§Ø± Ø¨Ø§Ø²Ø¯ÛŒØ¯</h2>
                <button class="test-btn btn-primary" onclick="testRecordView()">
                    Ø«Ø¨Øª Ø¨Ø§Ø²Ø¯ÛŒØ¯
                </button>
                <button class="test-btn btn-success" onclick="testGetStats()">
                    Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±
                </button>
                <button class="test-btn btn-warning" onclick="testTopListings()">
                    Ù¾Ø±Ø·Ø±ÙØ¯Ø§Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§
                </button>
                <div class="endpoint">POST /api/listing-stats/:id/view</div>
                <div id="stats-result"></div>
            </div>

            <!-- ØªÙ…Ø¯ÛŒØ¯ -->
            <div class="card">
                <h2><span class="icon">ğŸ”„</span> ØªÙ…Ø¯ÛŒØ¯ Ø¢Ú¯Ù‡ÛŒ</h2>
                <button class="test-btn btn-primary" onclick="testRenewalSettings()">
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ…Ø¯ÛŒØ¯
                </button>
                <button class="test-btn btn-success" onclick="testCheckRenewal()">
                    Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª
                </button>
                <button class="test-btn btn-warning" onclick="testExpiringListings()">
                    Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø± Ø­Ø§Ù„ Ø§Ù†Ù‚Ø¶Ø§
                </button>
                <div class="endpoint">GET /api/renewals/settings</div>
                <div id="renewal-result"></div>
            </div>

            <!-- Ø§Ø¯Ù…ÛŒÙ† -->
            <div class="card">
                <h2><span class="icon">ğŸ‘‘</span> Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†</h2>
                <button class="test-btn btn-primary" onclick="testAdminRenewals()">
                    Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ ØªÙ…Ø¯ÛŒØ¯
                </button>
                <button class="test-btn btn-success" onclick="testRenewalStats()">
                    Ø¢Ù…Ø§Ø± ØªÙ…Ø¯ÛŒØ¯Ù‡Ø§
                </button>
                <button class="test-btn btn-danger" onclick="testExpireOld()">
                    Ù…Ù†Ù‚Ø¶ÛŒ Ú©Ø±Ø¯Ù† Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒÙ‡Ø§
                </button>
                <div class="endpoint">GET /api/admin/renewals/pending</div>
                <div id="admin-result"></div>
            </div>
        </div>

        <!-- Ø³Ø±ÙˆØ± Ø§Ø³ØªØ§ØªÙˆØ³ -->
        <div class="card">
            <h2><span class="icon">ğŸš€</span> ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ±Ù‡Ø§</h2>
            <div class="grid" style="grid-template-columns: repeat(3, 1fr);">
                <button class="test-btn btn-primary" onclick="testBackend()">
                    Backend Health
                </button>
                <button class="test-btn btn-success" onclick="testFrontend()">
                    Frontend
                </button>
                <button class="test-btn btn-warning" onclick="testDatabase()">
                    Database
                </button>
            </div>
            <div id="server-result"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080/api';
        const token = localStorage.getItem('token'); // Ø§Ú¯Ø± Ù„Ø§Ú¯ÛŒÙ† Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´ÛŒØ¯

        function showResult(elementId, data, isError = false) {
            const el = document.getElementById(elementId);
            el.className = `result ${isError ? 'error' : 'success'}`;
            el.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        async function apiCall(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...(token && { 'Authorization': `Bearer ${token}` }),
                        ...options.headers
                    }
                });
                return await response.json();
            } catch (error) {
                return { error: error.message };
            }
        }

        // Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
        async function testNotifications() {
            const data = await apiCall(`${API_URL}/notifications?limit=5`);
            showResult('notifications-result', data, !!data.error);
        }

        async function testUnreadCount() {
            const data = await apiCall(`${API_URL}/notifications/unread-count`);
            showResult('notifications-result', data, !!data.error);
        }

        async function testMarkAllRead() {
            const data = await apiCall(`${API_URL}/notifications/read-all`, { method: 'PUT' });
            showResult('notifications-result', data, !!data.error);
        }

        // Ø¢Ù…Ø§Ø±
        async function testRecordView() {
            const data = await apiCall(`${API_URL}/listing-stats/1/view`, { method: 'POST' });
            showResult('stats-result', data, !!data.error);
        }

        async function testGetStats() {
            const data = await apiCall(`${API_URL}/listing-stats/1/summary`);
            showResult('stats-result', data, !!data.error);
        }

        async function testTopListings() {
            const data = await apiCall(`${API_URL}/listing-stats/top?limit=5`);
            showResult('stats-result', data, !!data.error);
        }

        // ØªÙ…Ø¯ÛŒØ¯
        async function testRenewalSettings() {
            const data = await apiCall(`${API_URL}/renewals/settings`);
            showResult('renewal-result', data, !!data.error);
        }

        async function testCheckRenewal() {
            const data = await apiCall(`${API_URL}/renewals/check/1`);
            showResult('renewal-result', data, !!data.error);
        }

        async function testExpiringListings() {
            const data = await apiCall(`${API_URL}/renewals/expiring`);
            showResult('renewal-result', data, !!data.error);
        }

        // Ø§Ø¯Ù…ÛŒÙ†
        async function testAdminRenewals() {
            const data = await apiCall(`${API_URL}/admin/renewals/pending`);
            showResult('admin-result', data, !!data.error);
        }

        async function testRenewalStats() {
            const data = await apiCall(`${API_URL}/admin/renewals/stats`);
            showResult('admin-result', data, !!data.error);
        }

        async function testExpireOld() {
            if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
            const data = await apiCall(`${API_URL}/admin/renewals/expire-old`, { method: 'POST' });
            showResult('admin-result', data, !!data.error);
        }

        // Ø³Ø±ÙˆØ±
        async function testBackend() {
            const data = await apiCall('http://localhost:8080/health');
            showResult('server-result', data, !!data.error);
        }

        async function testFrontend() {
            try {
                const response = await fetch('http://localhost:5173');
                showResult('server-result', { 
                    status: response.status, 
                    message: 'Frontend is running!' 
                });
            } catch (error) {
                showResult('server-result', { error: error.message }, true);
            }
        }

        async function testDatabase() {
            const data = await apiCall(`${API_URL}/renewals/settings`);
            showResult('server-result', { 
                database: data.success ? 'Connected âœ…' : 'Error âŒ',
                ...data 
            }, !data.success);
        }

        // Auto test on load
        window.onload = () => {
            console.log('ğŸ”” Ø³ÛŒØ³ØªÙ… Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§ Ùˆ ØªÙ…Ø¯ÛŒØ¯ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³Øª!');
            testBackend();
        };
    </script>
</body>
</html>
