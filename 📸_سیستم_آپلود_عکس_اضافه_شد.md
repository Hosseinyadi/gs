# 📸 سیستم آپلود عکس اضافه شد

## ✅ قابلیت‌های جدید:

### 1. آپلود تصویر در فرم ثبت آگهی
- **حداقل 1 عکس** (اجباری)
- **حداکثر 5 عکس**
- برای هر دو نوع آگهی (فروش و اجاره)

### 2. محدودیت‌ها:
- ✅ حداقل 1 عکس الزامی
- ✅ حداکثر 5 عکس
- ✅ حداکثر حجم هر عکس: 5MB
- ✅ فرمت‌های مجاز: JPG, PNG, WEBP

### 3. ویژگی‌ها:
- ✅ آپلود چند عکس همزمان
- ✅ پیش‌نمایش تصاویر
- ✅ حذف تصاویر
- ✅ نمایش عکس اصلی (اولین عکس)
- ✅ تبدیل خودکار به Base64
- ✅ نمایش در خلاصه آگهی

---

## 📋 فایل‌های ایجاد/تغییر یافته:

### 1. کامپوننت جدید: `ImageUpload.tsx`
```typescript
// مسیر: src/components/ui/ImageUpload.tsx

interface ImageUploadProps {
  images: string[];
  onImagesChange: (images: string[]) => void;
  maxImages?: number;      // پیش‌فرض: 5
  minImages?: number;      // پیش‌فرض: 1
  required?: boolean;      // پیش‌فرض: true
}
```

**قابلیت‌ها:**
- آپلود چند فایل همزمان
- Drag & Drop (در نسخه‌های بعدی)
- پیش‌نمایش تصاویر در Grid
- حذف تصاویر با دکمه X
- نمایش عکس اصلی
- Validation حجم و نوع فایل
- پیام‌های راهنما

### 2. تغییرات در `PostAd.tsx`

#### Import:
```typescript
import ImageUpload from "@/components/ui/ImageUpload";
```

#### در Step 2 (جزئیات آگهی):
```typescript
<ImageUpload
  images={form.images}
  onImagesChange={(images) => setForm(prev => ({ ...prev, images }))}
  maxImages={5}
  minImages={1}
  required={true}
/>
```

#### Validation:
```typescript
// در nextStep:
if (step === 2 && form.images.length === 0) {
  toast.error('لطفاً حداقل 1 عکس آپلود کنید');
  return;
}

// در handleSubmit:
if (form.images.length === 0) {
  toast.error('لطفاً حداقل 1 عکس آپلود کنید');
  return;
}
```

#### در Step 3 (خلاصه):
```typescript
{form.images.length > 0 && (
  <div>
    <strong>تصاویر:</strong>
    <div className="grid grid-cols-4 gap-2 mt-2">
      {form.images.map((img, idx) => (
        <img src={img} alt={`تصویر ${idx + 1}`} />
      ))}
    </div>
  </div>
)}
```

---

## 🎨 رابط کاربری:

### حالت خالی:
```
┌─────────────────────────────────────┐
│  تصاویر آگهی *                      │
│  حداقل 1 و حداکثر 5 عکس            │
│                                     │
│  ┌───────────────────────────────┐ │
│  │         📤 آپلود تصاویر       │ │
│  │  می‌توانید چند عکس را همزمان  │ │
│  │        انتخاب کنید            │ │
│  └───────────────────────────────┘ │
│                                     │
│  ℹ️ نکات مهم برای آپلود تصویر:    │
│  • اولین عکس = عکس اصلی            │
│  • از تصاویر با کیفیت استفاده کنید │
└─────────────────────────────────────┘
```

### با تصاویر:
```
┌─────────────────────────────────────┐
│  تصاویر آگهی *              3 / 5   │
│                                     │
│  ┌────┐ ┌────┐ ┌────┐              │
│  │ ✕  │ │ ✕  │ │ ✕  │              │
│  │img1│ │img2│ │img3│              │
│  │عکس │ └────┘ └────┘              │
│  │اصلی│                            │
│  └────┘                            │
│                                     │
│  ┌───────────────────────────────┐ │
│  │    📤 افزودن تصویر بیشتر      │ │
│  └───────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## 🧪 تست کنید:

### 1. تست آپلود عکس:

```
1. وارد شوید و به صفحه ثبت آگهی بروید
2. مراحل 0 و 1 را کامل کنید
3. در مرحله 2:
   
   ✅ آپلود 1 عکس:
   - کلیک روی "آپلود تصاویر"
   - یک عکس انتخاب کنید
   - باید پیش‌نمایش نمایش داده شود
   
   ✅ آپلود چند عکس همزمان:
   - کلیک روی "افزودن تصویر بیشتر"
   - چند عکس را همزمان انتخاب کنید (Ctrl+Click)
   - همه باید اضافه شوند
   
   ✅ حذف عکس:
   - موس را روی عکس ببرید
   - دکمه X ظاهر می‌شود
   - کلیک کنید → عکس حذف می‌شود
   
   ❌ بدون عکس:
   - سعی کنید بدون عکس به مرحله بعد بروید
   - باید خطا نمایش داده شود
```

### 2. تست محدودیت‌ها:

```
✅ حداکثر 5 عکس:
- سعی کنید 6 عکس آپلود کنید
- پیام: "حداکثر 5 عکس می‌توانید آپلود کنید"

✅ حجم فایل:
- سعی کنید فایل بزرگتر از 5MB آپلود کنید
- پیام: "حجم فایل بیش از 5MB است"

✅ نوع فایل:
- سعی کنید فایل غیر تصویری آپلود کنید
- پیام: "فایل یک تصویر نیست"
```

### 3. تست در خلاصه:

```
1. عکس‌ها را آپلود کنید
2. به مرحله 3 (تایید و ثبت) بروید
3. باید تمام عکس‌ها در Grid نمایش داده شوند
4. ثبت نهایی کنید
```

---

## 📊 ساختار داده:

### در State:
```typescript
images: string[]  // آرایه از Base64 strings
```

### ارسال به Backend:
```json
{
  "title": "...",
  "description": "...",
  "images": [
    "data:image/jpeg;base64,/9j/4AAQSkZJRg...",
    "data:image/png;base64,iVBORw0KGgoAAAA...",
    "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
  ]
}
```

---

## 🎯 نکات مهم:

### برای کاربران:
1. اولین عکس به عنوان **عکس اصلی** نمایش داده می‌شود
2. از تصاویر **با کیفیت و واضح** استفاده کنید
3. تصاویر از **زوایای مختلف** محصول را آپلود کنید
4. حداقل **1 عکس الزامی** است

### برای توسعه‌دهندگان:
1. تصاویر به صورت **Base64** ذخیره می‌شوند
2. برای بهینه‌سازی، می‌توان از **Image Compression** استفاده کرد
3. در آینده می‌توان **Upload به سرور** را اضافه کرد
4. می‌توان **Drag & Drop** را اضافه کرد

---

## ✅ همه چیز آماده است!

سرورها را restart کنید:
```bash
restart-servers.bat
```

حالا می‌توانید آگهی با عکس ثبت کنید! 📸🚀
