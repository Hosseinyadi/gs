# ✅ سیستم تایید آگهی و تنظیمات پرداخت کامل شد

## 🎯 ویژگی‌های پیاده شده

### 1. سیستم تایید آگهی ✅

#### تغییرات دیتابیس:
- ✅ فیلد `approval_status` اضافه شد (pending, approved, rejected)
- ✅ فیلد `rejection_reason` برای دلیل رد
- ✅ فیلد `approved_by` برای ادمین تایید کننده
- ✅ فیلد `approved_at` برای زمان تایید
- ✅ جدول `notifications` برای اطلاع‌رسانی

#### فرآیند کار:
1. **کاربر آگهی ایجاد می‌کنه** → وضعیت: `pending`
2. **ادمین آگهی رو می‌بینه** در پنل مدیریت
3. **ادمین تایید یا رد می‌کنه**:
   - تایید → وضعیت: `approved` + آگهی منتشر می‌شه
   - رد → وضعیت: `rejected` + دلیل رد ثبت می‌شه
4. **کاربر اطلاع‌رسانی دریافت می‌کنه**

#### دکمه‌های جدید در پنل ادمین:
- ✅ دکمه تایید (سبز) برای آگهی‌های pending
- ✅ دکمه رد (قرمز) با دیالوگ دلیل رد
- ✅ نمایش وضعیت آگهی با Badge

### 2. سیستم تنظیمات پرداخت ✅

#### ویژگی‌ها:
- ✅ **فقط سوپر ادمین** دسترسی داره
- ✅ تغییر شماره کارت با ماسک امنیتی
- ✅ تغییر نام دارنده کارت
- ✅ تغییر نام بانک
- ✅ تنظیم قیمت روزانه ویژه‌سازی
- ✅ تنظیم مهلت پرداخت (دقیقه)

#### امنیت:
- 🔒 شماره کارت به صورت ماسک شده نمایش داده می‌شه
- 🔒 فقط سوپر ادمین می‌تونه تغییر بده
- 🔒 تمام تغییرات در audit log ثبت می‌شه

---

## 🚀 نحوه استفاده

### تایید/رد آگهی:

1. **ورود به پنل ادمین**: http://localhost:5173/admin
2. **رفتن به "مدیریت آگهی‌ها"**
3. **آگهی‌های pending رو می‌بینی** با دکمه‌های تایید/رد
4. **برای تایید**: روی دکمه سبز کلیک کن
5. **برای رد**: روی دکمه قرمز کلیک کن و دلیل رو بنویس

### تنظیمات پرداخت (فقط سوپر ادمین):

1. **ورود به پنل ادمین** با حساب سوپر ادمین
2. **رفتن به "تنظیمات پرداخت"**
3. **تغییر اطلاعات**:
   - شماره کارت (16 رقم)
   - نام دارنده کارت
   - نام بانک
   - قیمت روزانه (تومان)
   - مهلت پرداخت (دقیقه)
4. **ذخیره تنظیمات**

---

## 📊 API Endpoints جدید

### تایید آگهی:
```bash
# تایید آگهی
POST /api/admin/listings/:id/approve

# رد آگهی
POST /api/admin/listings/:id/reject
{
  "reason": "دلیل رد آگهی"
}

# لیست آگهی‌های pending
GET /api/admin/listings/pending/all?page=1&limit=20
```

### تنظیمات پرداخت:
```bash
# دریافت تنظیمات
GET /api/admin/settings?category=payment

# به‌روزرسانی تنظیمات (فقط سوپر ادمین)
POST /api/admin/settings/bulk-update
{
  "settings": [
    {"key": "card_number", "value": "6037-9977-1234-5678"},
    {"key": "cardholder_name", "value": "علی احمدی"},
    {"key": "bank_name", "value": "بانک ملی ایران"},
    {"key": "price_per_day", "value": "50000"},
    {"key": "payment_window_min", "value": "30"}
  ]
}
```

---

## 🔄 فرآیند کامل

### برای کاربر عادی:
1. آگهی ایجاد می‌کنه
2. پیام می‌بینه: "آگهی در انتظار تایید مدیریت است"
3. اطلاع‌رسانی دریافت می‌کنه (تایید یا رد)

### برای ادمین:
1. آگهی‌های pending رو می‌بینه
2. تایید یا رد می‌کنه
3. در صورت رد، دلیل می‌نویسه

### برای سوپر ادمین:
1. همه کارهای ادمین عادی
2. **اضافه**: تغییر تنظیمات پرداخت
3. **اضافه**: تغییر شماره کارت هر موقع بخواد

---

## 🧪 تست کردن

### 1. تست سیستم تایید:
```bash
# اجرای migration
cd server
node database/run-approval-migration.js

# ری‌استارت سرور
# ایجاد آگهی جدید از فرانت
# چک کردن وضعیت pending در پنل ادمین
```

### 2. تست تنظیمات پرداخت:
```bash
# ورود با حساب سوپر ادمین
# رفتن به تب "تنظیمات پرداخت"
# تغییر شماره کارت
# ذخیره و بررسی
```

---

## 📋 جدول‌های دیتابیس

### listings (فیلدهای جدید):
```sql
approval_status VARCHAR(20) DEFAULT 'pending'  -- pending, approved, rejected
rejection_reason TEXT                          -- دلیل رد
approved_by INTEGER                           -- ID ادمین
approved_at DATETIME                          -- زمان تایید/رد
```

### notifications:
```sql
CREATE TABLE notifications (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    type VARCHAR(50) NOT NULL,           -- listing_approved, listing_rejected
    title VARCHAR(200) NOT NULL,
    message TEXT NOT NULL,
    data TEXT,                          -- JSON اطلاعات اضافی
    is_read BOOLEAN DEFAULT 0,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### system_settings:
```sql
-- برای ذخیره تنظیمات پرداخت
setting_key: card_number, cardholder_name, bank_name, price_per_day, payment_window_min
category: payment
```

---

## 🎉 همه چی آماده است!

✅ **سیستم تایید آگهی**: کاربران آگهی ایجاد می‌کنن، ادمین تایید/رد می‌کنه، کاربر اطلاع‌رسانی دریافت می‌کنه

✅ **تنظیمات پرداخت**: سوپر ادمین می‌تونه شماره کارت و سایر تنظیمات رو هر موقع تغییر بده

✅ **امنیت**: دسترسی‌ها کنترل شده، لاگ‌ها ثبت می‌شه، شماره کارت ماسک می‌شه

**برو و تست کن! 🚀**