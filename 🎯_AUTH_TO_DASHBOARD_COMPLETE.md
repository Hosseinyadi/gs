# ✅ جریان کامل احراز هویت و ورود به پنل کاربری

## 🔐 جریان احراز هویت کامل شد!

### 📱 دو روش ورود/ثبت‌نام:

#### 1️⃣ ورود با رمز عبور (Password)
```
کاربر جدید:
1. وارد کردن شماره موبایل
2. وارد کردن نام
3. تعیین رمز عبور (حداقل 6 کاراکتر)
4. تکرار رمز عبور
5. کلیک روی "ثبت‌نام"
6. ✅ ورود موفق → هدایت به پنل کاربری

کاربر قبلی:
1. وارد کردن شماره موبایل
2. وارد کردن رمز عبور
3. کلیک روی "ورود"
4. ✅ ورود موفق → هدایت به پنل کاربری
```

#### 2️⃣ ورود با کد یکبار مصرف (OTP)
```
1. وارد کردن شماره موبایل
2. وارد کردن نام (اختیاری)
3. کلیک روی "ارسال کد تایید"
4. دریافت کد 6 رقمی از SMS
5. وارد کردن کد تایید
6. کلیک روی "تایید"
7. ✅ ورود موفق → هدایت به پنل کاربری
```

---

## 🎯 مسیرهای هدایت بعد از ورود:

### ✅ هدایت خودکار:
- **ورود عادی**: `/dashboard` (پنل کاربری)
- **ورود از صفحه محافظت شده**: بازگشت به همان صفحه
  - مثال: کلیک روی "ثبت آگهی" → ورود → بازگشت به `/post-ad-type`

### 📍 صفحات در دسترس بعد از ورود:
1. **پنل کاربری** (`/dashboard`):
   - پروفایل کاربر
   - آگهی‌های من
   - آگهی‌های ویژه
   - پرداخت‌ها
   - علاقه‌مندی‌ها
   - تنظیمات

2. **پنل فروشنده** (`/seller`):
   - مدیریت آگهی‌ها
   - آمار فروش

3. **ثبت آگهی** (`/post-ad-type` → `/post-ad`):
   - انتخاب نوع آگهی (فروش/اجاره)
   - فرم ثبت آگهی کامل

---

## 🔗 لینک‌های دسترسی در Header:

### کاربر وارد نشده:
```
- ورود/ثبت‌نام → /auth
- ثبت آگهی → /post-ad-type (نیاز به ورود)
```

### کاربر وارد شده:
```
- پنل کاربری → /dashboard
- پنل فروشنده → /seller
- خروج → logout()
```

---

## 🎨 ویژگی‌های پنل کاربری:

### 📊 تب‌های موجود:
1. **پروفایل**: ویرایش اطلاعات شخصی
2. **آگهی‌های من**: مشاهده و مدیریت آگهی‌ها
3. **آگهی‌های ویژه**: آگهی‌های ویژه شده
4. **پرداخت‌ها**: تاریخچه پرداخت‌ها
5. **علاقه‌مندی‌ها**: آگهی‌های ذخیره شده
6. **تنظیمات**: تنظیمات حساب کاربری

### 🛠️ عملیات روی آگهی‌ها:
- ✅ مشاهده آگهی
- ✅ ویرایش آگهی
- ✅ حذف آگهی
- ✅ ویژه کردن آگهی (پرداخت کارت به کارت)
- ✅ مشاهده آمار بازدید

---

## 🔒 محافظت از مسیرها:

### مسیرهای محافظت شده (نیاز به ورود):
```typescript
<Route path="/dashboard" element={<ProtectedRoute><UserDashboard /></ProtectedRoute>} />
<Route path="/seller" element={<ProtectedRoute><SellerDashboard /></ProtectedRoute>} />
<Route path="/post-ad-type" element={<ProtectedRoute><PostAdType /></ProtectedRoute>} />
<Route path="/post-ad" element={<ProtectedRoute><PostAd /></ProtectedRoute>} />
<Route path="/make-featured" element={<ProtectedRoute><MakeFeatured /></ProtectedRoute>} />
<Route path="/payment/card-transfer" element={<ProtectedRoute><CardTransfer /></ProtectedRoute>} />
<Route path="/payment/history" element={<ProtectedRoute><PaymentHistory /></ProtectedRoute>} />
```

### مسیرهای ادمین (نیاز به ورود ادمین):
```typescript
<Route path="/admin" element={<ProtectedRoute requireAdmin><Admin /></ProtectedRoute>} />
<Route path="/admin/analytics" element={<ProtectedRoute requireAdmin><AdminAnalyticsDashboard /></ProtectedRoute>} />
<Route path="/admin/management" element={<ProtectedRoute requireAdmin><AdminManagement /></ProtectedRoute>} />
```

---

## 🧪 تست جریان کامل:

### تست 1: ثبت‌نام با رمز عبور
```bash
1. باز کردن: http://localhost:5173
2. کلیک روی "ورود/ثبت‌نام" در Header
3. انتخاب تب "رمز عبور"
4. وارد کردن شماره: 09123456789
5. وارد کردن نام: علی احمدی
6. تعیین رمز عبور: abc123
7. تکرار رمز عبور: abc123
8. کلیک روی "ثبت‌نام"
9. ✅ هدایت به /dashboard
```

### تست 2: ورود با رمز عبور
```bash
1. باز کردن: http://localhost:5173/auth
2. انتخاب تب "رمز عبور"
3. وارد کردن شماره: 09123456789
4. وارد کردن رمز عبور: abc123
5. کلیک روی "ورود"
6. ✅ هدایت به /dashboard
```

### تست 3: ورود با OTP
```bash
1. باز کردن: http://localhost:5173/auth
2. انتخاب تب "کد یکبار مصرف"
3. وارد کردن شماره: 09123456789
4. وارد کردن نام: علی احمدی (اختیاری)
5. کلیک روی "ارسال کد تایید"
6. دریافت کد از Terminal سرور
7. وارد کردن کد 6 رقمی
8. کلیک روی "تایید"
9. ✅ هدایت به /dashboard
```

### تست 4: ثبت آگهی بدون ورود
```bash
1. باز کردن: http://localhost:5173
2. کلیک روی "ثبت آگهی" در Header
3. ✅ هدایت به /auth با state.from = /post-ad-type
4. ورود موفق
5. ✅ بازگشت خودکار به /post-ad-type
```

### تست 5: دسترسی به پنل کاربری
```bash
1. ورود به سیستم
2. کلیک روی "پنل کاربری" در Header
3. ✅ باز شدن /dashboard
4. مشاهده تب‌های مختلف
5. ویرایش پروفایل
6. مشاهده آگهی‌ها
```

---

## 📝 نکات مهم:

### ✅ ذخیره‌سازی:
- Token در `localStorage.auth_token`
- اطلاعات کاربر در `localStorage.user_data`
- بررسی خودکار احراز هویت در هر بارگذاری صفحه

### ✅ امنیت:
- رمز عبور حداقل 6 کاراکتر
- Hash شدن رمز عبور در سرور (bcrypt)
- کد OTP معتبر برای 5 دقیقه
- محافظت از مسیرها با ProtectedRoute

### ✅ تجربه کاربری:
- پیام‌های موفقیت/خطا با toast
- تایمر برای ارسال مجدد OTP
- نمایش/مخفی کردن رمز عبور
- بازگشت خودکار به صفحه قبلی بعد از ورود

---

## 🚀 آماده برای استفاده!

**همه چیز کاملاً کار می‌کند:**
- ✅ ثبت‌نام با رمز عبور
- ✅ ورود با رمز عبور
- ✅ ورود با OTP
- ✅ هدایت به پنل کاربری
- ✅ محافظت از مسیرها
- ✅ مدیریت آگهی‌ها
- ✅ ویژه کردن آگهی‌ها
- ✅ علاقه‌مندی‌ها

**شروع به تست کنید! 🎉**
